// Copyright (c) CLMS. All rights reserved.
// Licensed under the AGPL-3.0 license. See LICENSE file in the project root for full license information.
// This source file was autogenerated by zAppDev(r).
using System;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.Serialization;
using System.ServiceModel;
using System.Text;
using System.ServiceModel.Channels;
using System.Security.Permissions;
using System.Security.Principal;
using NHibernate;
using System.ServiceModel.Activation;
using zAppDev.DotNet.Framework.Utilities;
using zAppDev.DotNet.Framework.Data.Domain;
using DSS5_SupplyChainFinancialsOptimisation.Services.HomePageContact.DataContracts;
using DSS5_SupplyChainFinancialsOptimisation.BO;
using AutoMapper;

namespace DSS5_SupplyChainFinancialsOptimisation.Services
{
    [AspNetCompatibilityRequirements(RequirementsMode = AspNetCompatibilityRequirementsMode.Required)]
    public class HomePageContactService : IHomePageContactService
    {
        public ContactDTO HomePageContact(string _last_name, string _email, string _message, string _RequestSourceIp, string _UserName)
        {
            InitializeMappers();
            try
            {
                var inputlast_name = _last_name;
                var inputemail = _email;
                var inputmessage = _message;
                var _homePageContact = HomePageContactImplementation(inputlast_name, inputemail, inputmessage);
                var result = Mapper.Map<DSS5_SupplyChainFinancialsOptimisation.BO.Contact, ContactDTO>(_homePageContact);
                return result;
            }
            catch (Exception @exception)
            {
                log4net.LogManager.GetLogger("HomePageContact Service").Error(@exception);
                throw;
            }
        }


        private void InitializeMappers()
        {
            Mapper.CreateMap<ContactDTO, DSS5_SupplyChainFinancialsOptimisation.BO.Contact>();
            Mapper.CreateMap<DSS5_SupplyChainFinancialsOptimisation.BO.Contact, ContactDTO>();
        }

        public static DSS5_SupplyChainFinancialsOptimisation.BO.Contact HomePageContactImplementation(string last_name, string email, string message)
        {
            DSS5_SupplyChainFinancialsOptimisation.BO.Contact contact = new DSS5_SupplyChainFinancialsOptimisation.BO.Contact();
            contact.LastName = last_name;
            contact.Email = email;
            contact.Message = message;
            System.Collections.Generic.List<string> recipients = new System.Collections.Generic.List<string>();
            recipients.Add("info@tome-finance.com");
            zAppDev.DotNet.Framework.Utilities.EMailMessage em = new zAppDev.DotNet.Framework.Utilities.EMailMessage();
            em.Subject = "Tome Finance User Contact";
            em.IsBodyHtml = true;
            em.Body = "<p>New message from</p> <p>Last Name: " + (contact?.LastName ?? "") + "</p> <p>E-mail: " + (contact?.Email ?? "") + "</p> <p>Message: " + (contact?.Message ?? "") + "</p> <p>&nbsp;</p>";
            em.To = recipients.Distinct().ToList().ToList();
            zAppDev.DotNet.Framework.Utilities.Email.SendMail(em, true);
            return contact;
        }


    }
}